version: '3'
services:
  fambench_cvt_amd_8GPU:
    build:
      dockerfile: pyt_fambench.ubuntu.amd.Dockerfile
      context: .
    image: "${USER}/fambench-cvt-amd"
    restart: always
    env_file:
      - .env
    container_name: "${USER}-fambench-cvt-amd-8GPU"
    shm_size: '16gb'
    ipc: host
    cap_add:
      - SYS_PTRACE
      - SYS_ADMIN
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    network_mode: host
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    volumes:
      - ../:/workspace
    working_dir: /workspace
    tty: true

  rocblas_tot:
    build:
      dockerfile: rocblas_tot.Dockerfile
      context: .
    image: "${USER}/rocblas-tot"
    restart: always
    env_file:
      - .env
    container_name: "${USER}-rocblas-tot-amd-8GPU"
    shm_size: '16gb'
    ipc: host
    cap_add:
      - SYS_PTRACE
      - SYS_ADMIN
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    network_mode: host
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    volumes:
      - ../:/workspace
    working_dir: /workspace
    tty: true 
